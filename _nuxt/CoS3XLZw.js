var Fe=Object.defineProperty;var Ue=(e,n,t)=>n in e?Fe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var D=(e,n,t)=>Ue(e,typeof n!="symbol"?n+"":n,t);import{d as F,i as H,t as S,v,x as u,z as q,C as p,y as k,_ as Me,D as $e,E as de,F as fe,G as De,H as Je,I as V,A as ge,J as Le,K as Z,T as Ke,L as we,M as me,N as ye,O as We,r as X,o as je,P as ze,B as Ge}from"./Bqy9lLst.js";import{_ as He}from"./DlAUqK2U.js";const Ve={class:"flex py-2 text-white drop-shadow-lg rounded-lg bg-teal-700 hover:bg-teal-600 cursor-pointer"},Qe={class:"flex items-center justify-center px-2"},Ye={class:"flex-1"},qe={class:"text-xl"},Xe={class:"text-xs mt-1 mb-1"},Ze={class:"bg-teal-900 px-1 py-0.5 rounded"},en=F({__name:"PeerCard",props:{peer:{}},setup(e){const n=e,t=H(()=>{switch(n.peer.deviceType){case"mobile":return"material-symbols:smartphone";case"desktop":return"material-symbols:computer";case"web":return"material-symbols:language";case"headless":return"material-symbols:terminal";case"server":return"material-symbols:dns";default:return"material-symbols:help"}});return(o,r)=>{const d=Me;return S(),v("div",Ve,[u("div",Qe,[q(d,{name:p(t),class:"size-10"},null,8,["name"])]),u("div",Ye,[u("p",qe,k(n.peer.alias),1),u("p",Xe,[u("span",Ze,k(n.peer.deviceModel??"Unknown"),1),r[0]||(r[0]=u("span",{class:"ml-2 bg-teal-900 px-1 py-0.5 rounded"},"WebRTC",-1))])])])}}}),nn=$e("/apple-touch-icon.png");function tn(e){return I(new TextEncoder().encode(e))}function I(e){const n=Array.from(e).map(o=>String.fromCharCode(o)).join("");return btoa(n).replaceAll("=","").replaceAll("+","-").replaceAll("/","_")}function he(e){const t=e.padEnd(e.length+(4-e.length%4)%4,"=").replaceAll("-","+").replaceAll("_","/"),o=atob(t);return Uint8Array.from(o,r=>r.charCodeAt(0))}class re{constructor(n){D(this,"_socket");D(this,"_onAnswer",null);this._socket=n}static async connect({url:n,info:t,onMessage:o,generateNewInfo:r,onClose:d}){console.log(`Connecting to ${n}`);const f=tn(JSON.stringify(t)),c=await new Promise((i,l)=>{const h=new WebSocket(`${n}?d=${f}`);h.onopen=()=>i(h),h.onerror=N=>l(N)}),w=de(()=>{c.send("")},120*1e3),x=de(async()=>{const i=await r();c.send(JSON.stringify({type:"UPDATE",info:i}))},30*60*1e3);c.onclose=()=>{console.log("Signaling connection closed"),clearInterval(w),clearInterval(x),d()},console.log("Signaling connection established");const a=new re(c);return c.onmessage=i=>{const l=JSON.parse(i.data);console.log(`WS in: ${i.data}`),l.type==="ANSWER"&&a._onAnswer&&l.sessionId===a._onAnswer.sessionId&&(a._onAnswer.callback(l),a._onAnswer=null),o(l)},a}send(n){console.log(`WS out: ${JSON.stringify(n)}`),this._socket.send(JSON.stringify(n))}async waitForAnswer(n){return await new Promise(t=>{this._onAnswer={sessionId:n,callback:o=>t(o)}})}async waitUntilClose(){return new Promise(n=>{this._socket.addEventListener("close",()=>{n()})})}}var _e=(e=>(e.mobile="mobile",e.desktop="desktop",e.web="web",e.headless="headless",e.server="server",e))(_e||{});class sn{constructor(){D(this,"_stream");D(this,"_controller");let n;this._stream=new ReadableStream({start(t){n=t}}),this._controller=n}add(n){this._controller.enqueue(n)}async readNext(){const n=this._stream.getReader();try{const{value:t,done:o}=await n.read();if(o)throw new Error("No more data");return t}finally{n.releaseLock()}}createAsyncIterator(){let n;return{asyncIterator:this._createAsyncIterator(o=>n=o),releaseLock:()=>n.releaseLock()}}async*_createAsyncIterator(n){const t=this._stream.getReader();n(t);try{for(;;){const{value:o,done:r}=await t.read();if(r)break;yield o}}finally{t.releaseLock()}}}function on(e,n,t="application/octet-stream"){const o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}async function Se(){const e=new Uint8Array(32);return window.crypto.getRandomValues(e),e}function rn(e){return e.byteLength>=16&&e.byteLength<=128}const ee={ed25519:{identifier:"ed25519",generate:{name:"Ed25519"},import:{name:"Ed25519"},sign:{name:"Ed25519"}},rsaPss:{identifier:"rsa-pss",generate:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},import:{name:"RSA-PSS",hash:"SHA-256"},sign:{name:"RSA-PSS",saltLength:32}}};let Q=ee.rsaPss;function an(){return window.crypto&&window.crypto.subtle&&"generateKey"in window.crypto.subtle}async function cn(){try{await window.crypto.subtle.generateKey(ee.ed25519.generate,!0,["sign","verify"]),Q=ee.ed25519,console.log("Switched to Ed25519 for cryptographic operations.")}catch{console.warn("Ed25519 not supported.")}}async function ln(){return await window.crypto.subtle.generateKey(Q.generate,!0,["sign","verify"])}async function dn(e){const n=await window.crypto.subtle.exportKey("spki",e),t=btoa(String.fromCharCode(...new Uint8Array(n))),o=`-----BEGIN PUBLIC KEY-----
`,r=`
-----END PUBLIC KEY-----`,d=t.match(/.{1,64}/g).join(`
`);return o+d+r}async function xe(e){const n=un();return await ie(e,n)}async function ie(e,n){const t=new Uint8Array(await window.crypto.subtle.exportKey("spki",e.publicKey)),o=fn(t,n),r=await window.crypto.subtle.digest("SHA-256",o),d=await window.crypto.subtle.sign(Q.sign,e.privateKey,r),f="sha256",c=I(new Uint8Array(r)),w=I(n),x=Q.identifier,a=I(new Uint8Array(d));return[f,c,w,x,a].join(".")}function un(){const e=Math.floor(Date.now()/1e3);return pn(BigInt(e))}function pn(e){const n=new ArrayBuffer(8);return new DataView(n).setBigUint64(0,e,!0),new Uint8Array(n)}function fn(...e){const n=e.reduce((r,d)=>r+d.length,0),t=new Uint8Array(n);let o=0;for(const r of e)t.set(r,o),o+=r.length;return t}const gn="2.3",be=["stun:stun.l.google.com:19302"];async function wn({signaling:e,stunServers:n,fileDtoList:t,fileMap:o,targetId:r,signingKey:d,pin:f,onPin:c,onFilesSkip:w,onFileProgress:x}){console.log("Sending to target:",r),console.log("Sending files:",t);const a=await ke(n),i=a.createDataChannel("data");i.binaryType="arraybuffer";const l=ve(i),h=new Promise(y=>{i.onopen=()=>y()});console.log("Creating offer...");const N=await a.createOffer();await a.setLocalDescription(N),await Te(a);const C=a.localDescription.sdp;console.log("Local SDP: ",C);const O=Math.random().toString(36).substring(2,15);e.send({type:"OFFER",sessionId:O,target:r,sdp:Ne(C)}),console.log("Waiting for answer...");const K=await e.waitForAnswer(O),W=ne(K.sdp);console.log("Received answer SDP: ",W),await a.setRemoteDescription({type:"answer",sdp:W}),await h,console.log("Data channel opened. Exchanging nonce...");const T=await Se();i.send(JSON.stringify({nonce:I(T)}));const j=await Ee(l),A=new Uint8Array(T.length+j.length);A.set(T),A.set(j,T.length),console.log("Nonce exchanged. Exchanging token...");const E=await ie(d,A);i.send(JSON.stringify({token:E}));const U=await l.readNext();if(typeof U!="string")throw new Error("Expected string");const P=JSON.parse(U);if(P.status==="INVALID_SIGNATURE"){console.error("Invalid signature");return}let R;if(P.status==="OK")R=P.token;else if(P.status==="PIN_REQUIRED")R=P.token,await Pe(l,i,c,!1,y=>{const _=JSON.parse(y);return _.status==="PIN_REQUIRED"||_.status==="TOO_MANY_ATTEMPTS"?_.status:1});else{console.error("Invalid response");return}if(console.log(`Received token: ${R}`),f){let y="",_=0;for(;y!==f.pin;){if(_>=f.maxTries){G(i,JSON.stringify({status:"TOO_MANY_ATTEMPTS"})),J(i),await te(i);return}G(i,JSON.stringify({status:"PIN_REQUIRED"})),J(i);const $=await l.readNext();if(typeof $!="string")throw new Error("Expected string");y=JSON.parse($).pin,_++}}G(i,JSON.stringify({status:"OK",files:t})),J(i),console.log("Sent file list. Waiting for selection...");let B=await Y(l),m=JSON.parse(B),g;if(m.status==="OK")g=m.files;else if(m.status==="PAIR")if(console.log("Pairing required. Reject..."),i.send(JSON.stringify({status:"PAIR_DECLINED"})),B=await Y(l),m=JSON.parse(B),m.status==="OK")g=m.files;else return;else return;console.log(`Selected files: ${Object.keys(g).length} / ${t.length}`);const b=[];t=t.filter(y=>{const _=g[y.id];return _||b.push(y.id),_}),b.length>0&&w(b);const M=Date.now(),ae=t[0];i.send(JSON.stringify({id:ae.id,token:g[ae.id]}));for(let y=0;y<t.length;y++){const _=t[y],$=o[_.id],Re=$.size;if(console.log(`Sending file: ${_.fileName}`),await hn(i,$,z=>{x({id:_.id,curr:z})}),y+1<t.length){const z=t[y+1],Be=g[z.id];i.send(JSON.stringify({id:z.id,token:Be}))}else J(i);console.log("Waiting for file status...");const ce=await l.readNext();if(typeof ce!="string")throw new Error("Expected string");const le=JSON.parse(ce);x({id:_.id,curr:Re,success:le.success,error:le.error})}const Ae=t.reduce((y,_)=>y+_.size,0);console.log(`Finished in ${Date.now()-M} ms. Speed: ${Ae*1e3/(Date.now()-M)/(1024*1024)} MB/s`),i.close(),a.close(),console.log("Connection closed")}async function mn({signaling:e,stunServers:n,offer:t,signingKey:o,pin:r,onPin:d,selectFiles:f,onFileProgress:c}){console.log("Accepting offer from:",t.peer.id),console.log("Remote SDP: ",ne(t.sdp));const w=await ke(n),x=new Promise(g=>{w.ondatachannel=b=>{g(b.channel)}});await w.setRemoteDescription({type:"offer",sdp:ne(t.sdp)}),console.log("Creating answer...");const a=await w.createAnswer();await w.setLocalDescription(a),await Te(w);const i=w.localDescription.sdp;console.log("Local SDP: ",i),e.send({type:"ANSWER",sessionId:t.sessionId,target:t.peer.id,sdp:Ne(i)}),console.log("Waiting for data channel...");const l=await x;l.binaryType="arraybuffer",console.log("Received data channel");const h=ve(l);await new Promise(g=>{l.onopen=()=>g()}),console.log("Data channel opened. Exchanging nonce...");const N=await Ee(h),C=await Se();l.send(JSON.stringify({nonce:I(C)}));const O=new Uint8Array(C.length+N.length);O.set(N),O.set(C,N.length);const K=await h.readNext();if(typeof K!="string")throw new Error("Expected string");const W=JSON.parse(K);console.log(`Received token: ${W.token}`);const T=await ie(o,O);if(r){let g="",b=0;for(l.send(JSON.stringify({status:"PIN_REQUIRED",token:T}));g!==r.pin;){if(b>=r.maxTries){l.send(JSON.stringify({status:"TOO_MANY_ATTEMPTS"})),await te(l);return}b!==0&&l.send(JSON.stringify({status:"PIN_REQUIRED"}));const M=await h.readNext();if(typeof M!="string")throw new Error("Expected string");g=JSON.parse(M).pin,b++}l.send(JSON.stringify({status:"OK"}))}else l.send(JSON.stringify({status:"OK",token:T}));console.log("Waiting for sender PIN status...");let j=await Y(h),A=JSON.parse(j),E;switch(A.status){case"OK":E=A.files;break;case"TOO_MANY_ATTEMPTS":console.error("Too many attempts");return;case"PIN_REQUIRED":E=await Pe(h,l,d,!0,g=>{const b=JSON.parse(g);return b.status==="PIN_REQUIRED"||b.status==="TOO_MANY_ATTEMPTS"?b.status:b.files});break}console.log("Received file list:",E);const U=await f(E),P={},R={};for(const g of E)U.includes(g.id)&&(P[g.id]=g,R[g.id]=Math.random().toString());console.log(`Selected files: ${U.length} / ${E.length}`),G(l,JSON.stringify({status:"OK",files:R})),J(l),console.log("Receiving files...");const B=h.createAsyncIterator();let m=null;for await(const g of B.asyncIterator)if(typeof g=="string"){if(m&&(on(new Blob(m.chunks),P[m.id].fileName),c({id:m.id,curr:m.curr,success:!0}),l.send(JSON.stringify({id:m.id,success:!0})),g.length<=1)){m=null,await te(l);break}m={id:JSON.parse(g).id,chunks:[],curr:0}}else{if(!m)throw new Error("Expected file state");m.chunks.push(g),m.curr+=g.byteLength,c({id:m.id,curr:m.curr})}B.releaseLock(),l.close(),w.close()}async function ke(e){const n=new RTCPeerConnection({iceServers:e.length===0?void 0:[{urls:e}]});return n.onicecandidateerror=t=>{console.error("ICE candidate error:",t)},n.oniceconnectionstatechange=()=>{var t;console.log("ICE connection state:",n.iceConnectionState,(t=n.getConfiguration().iceServers)==null?void 0:t.map(o=>o.urls))},n}function ve(e){const n=new sn;return e.onmessage=t=>{n.add(t.data)},n}function Ne(e){const n=new TextEncoder().encode(e),t=fe.deflate(n);return I(t)}function ne(e){const n=he(e),t=fe.inflate(n);if(!t)throw new Error("Decompression failed.");return new TextDecoder().decode(t)}async function Ee(e){const n=await e.readNext();if(typeof n!="string")throw new Error("Expected string");const t=JSON.parse(n),o=he(t.nonce);if(!rn(o))throw new Error("Invalid remote nonce");return o}async function Pe(e,n,t,o,r){for(;;){const d=await t();if(!d)throw n.close(),new Error("PIN required");n.send(JSON.stringify({pin:d}));let f;if(o)f=await Y(e);else{const w=await e.readNext();if(typeof w!="string")throw new Error("Expected string");f=w}const c=r(f);if(c&&typeof c!="string")return c;switch(c){case"PIN_REQUIRED":break;case"TOO_MANY_ATTEMPTS":throw new Error("Too many attempts")}}}async function Y(e){let n=e.createAsyncIterator(),t=[];for await(const o of n.asyncIterator){if(typeof o=="string")break;t.push(o)}return n.releaseLock(),_n(t)}function J(e){e.send("0")}const L=16*1024,yn=1024*1024;function G(e,n){const t=new TextEncoder().encode(n);for(let o=0;o<t.length;o+=L)e.send(t.slice(o,o+L))}async function hn(e,n,t){const o=n.stream().getReader();let r=new Uint8Array(0),d=0;for(;;){const{done:f,value:c}=await o.read();if(f){r.length>0&&e.send(r);break}const w=new Uint8Array(r.length+c.length);for(w.set(r),w.set(c,r.length),r=w;r.length>=L;){for(;e.bufferedAmount>yn;)await new Promise(a=>setTimeout(a,50));const x=r.slice(0,L);e.send(x),d+=x.length,t(d),r=r.slice(L)}}}function _n(e){const n=e.reduce((r,d)=>r+d.byteLength,0),t=new Uint8Array(n);let o=0;return e.forEach(r=>{t.set(new Uint8Array(r),o),o+=r.byteLength}),new TextDecoder().decode(t)}async function te(e){for(;e.bufferedAmount>0;)await new Promise(n=>setTimeout(n,50))}async function Te(e){e.iceGatheringState!=="complete"&&await new Promise(n=>{e.onicegatheringstatechange=()=>{e.iceGatheringState==="complete"&&n()}})}var se=(e=>(e.idle="idle",e.sending="sending",e.receiving="receiving",e))(se||{});const s=De({_loopStarted:!1,_proposingClient:null,_onPin:null,key:null,pin:null,signaling:null,client:null,peers:[],session:{state:"idle",curr:0,total:1,fileState:{}}});async function Sn({info:e,onPin:n}){s._proposingClient=e,s._onPin=n,s._loopStarted||(s._loopStarted=!0,xn().then(()=>console.log("Connection loop ended")))}async function xn(){for(;;)try{s.signaling=await re.connect({url:"wss://public.localsend.org/v1/ws",info:s._proposingClient,onMessage:e=>{switch(e.type){case"HELLO":s.client=e.client,s.peers=e.peers;break;case"JOIN":s.peers=[...s.peers,e.peer];break;case"UPDATE":s.peers=s.peers.map(n=>n.id===e.peer.id?e.peer:n);break;case"LEFT":s.peers=s.peers.filter(n=>n.id!==e.peerId);break;case"OFFER":En({offer:e,onPin:s._onPin});break;case"ANSWER":break}},generateNewInfo:async()=>{const e=await xe(s.key);return kn(e),{...s._proposingClient,token:e}},onClose:()=>{s.signaling=null,s.client=null,s.peers=[]}}),await s.signaling.waitUntilClose()}catch{console.log("Retrying connection in 5 seconds..."),await new Promise(n=>setTimeout(n,5e3))}}function bn(e){s._proposingClient.alias=e,s.client.alias=e}function kn(e){s._proposingClient.token=e,s.client.token=e}const Ie=3;async function vn({files:e,targetId:n,onPin:t}){s.session.state="sending";const o={},r=Nn(e),d=r.reduce((f,c)=>(f[c.id]=e[parseInt(c.id)],o[c.id]={id:c.id,name:c.fileName,curr:0,total:c.size,state:"pending"},f),{});s.session.fileState=o,s.session.curr=0,s.session.total=r.reduce((f,c)=>f+c.size,0);try{await wn({signaling:s.signaling,stunServers:be,fileDtoList:r,fileMap:d,targetId:n,signingKey:s.key,pin:s.pin?{pin:s.pin,maxTries:Ie}:void 0,onPin:t,onFilesSkip:f=>{for(const c of f)s.session.fileState[c].state="skipped"},onFileProgress:Ce})}finally{s.session.state="idle"}}function Nn(e){const n=[];for(let t=0;t<e.length;t++){const o=e[t];n.push({id:t.toString(),fileName:o.name,size:o.size,fileType:o.type,metadata:{modified:new Date(o.lastModified).toISOString()}})}return n}async function En({offer:e,onPin:n}){s.session.state="receiving";try{await mn({signaling:s.signaling,stunServers:be,offer:e,signingKey:s.key,pin:s.pin?{pin:s.pin,maxTries:Ie}:void 0,onPin:n,selectFiles:async t=>{s.session.curr=0,s.session.total=t.reduce((o,r)=>o+r.size,0),s.session.fileState={};for(const o of t)s.session.fileState[o.id]={id:o.id,name:o.fileName,curr:0,total:o.size,state:"pending"};return t.map(o=>o.id)},onFileProgress:Ce})}finally{s.session.state="idle"}}function Ce(e){s.session.fileState[e.id].curr=e.curr,s.session.curr=Object.values(s.session.fileState).reduce((n,t)=>n+t.curr,0),e.success?s.session.fileState[e.id].state="finished":e.error&&(s.session.fileState[e.id].state="error",s.session.fileState[e.id].error=e.error)}function Pn(e){const n=Tn(e),t=In(e);return n&&t?`${t} â€¢ ${n}`:n||t||"Unknown"}function Tn(e){return e.includes("Firefox")?"Firefox":e.includes("Chrome")?"Chrome":e.includes("Safari")?"Safari":e.includes("Opera")||e.includes("OPR")?"Opera":e.includes("Edg")?"Edge":e.includes("MSIE")||e.includes("Trident")?"Internet Explorer":e.includes("insomnia")?"Insomnia":null}function In(e){return e.includes("Win")?"Windows":e.includes("Android")?"Android":e.includes("Macintosh")?"macOS":e.includes("iPhone")||e.includes("iPad")||e.includes("iPod")?"iOS":e.includes("X11")?"Linux":null}const ue=["Adorable","Beautiful","Big","Bright","Clean","Clever","Cool","Cute","Cunning","Determined","Energetic","Efficient","Fantastic","Fast","Fine","Fresh","Good","Gorgeous","Great","Handsome","Hot","Kind","Lovely","Mystic","Neat","Nice","Patient","Pretty","Powerful","Rich","Secret","Smart","Solid","Special","Strategic","Strong","Tidy","Wise"],pe=["Apple","Avocado","Banana","Blackberry","Blueberry","Broccoli","Carrot","Cherry","Coconut","Grape","Lemon","Lettuce","Mango","Melon","Mushroom","Onion","Orange","Papaya","Peach","Pear","Pineapple","Potato","Pumpkin","Raspberry","Strawberry","Tomato"];function Cn(){const e=ue[Math.floor(Math.random()*ue.length)],n=pe[Math.floor(Math.random()*pe.length)];return`${e} ${n}`}const On={class:"w-full h-2 bg-gray-200 rounded-lg mt-1"},Oe=F({__name:"ProgressBar",props:{progress:{}},setup(e){const n=e;return(t,o)=>(S(),v("div",On,[u("div",{class:"h-full bg-teal-500 rounded-lg",style:Je({width:`${n.progress*100}%`})},null,4)]))}});function oe(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(1)+" MB":(e/(1024*1024*1024)).toFixed(1)+" GB"}const An={class:"flex"},Rn={class:"flex-1 truncate"},Bn=F({__name:"FileProgress",props:{state:{}},setup(e){const n=e,t=H(()=>oe(n.state.total));return(o,r)=>{const d=Oe;return S(),v("div",null,[u("div",An,[u("span",Rn,k(n.state.name),1),u("span",null,k(p(t)),1)]),q(d,{progress:n.state.curr/n.state.total},null,8,["progress"])])}}}),Fn={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Un={class:"bg-white w-full max-w-lg mx-4 rounded shadow-md text-black",role:"dialog","aria-modal":"true"},Mn=F({__name:"Dialog",props:{visible:{type:Boolean}},setup(e){const n=e;return(t,o)=>(S(),V(Ke,{name:"fade"},{default:ge(()=>[n.visible?(S(),v("div",Fn,[u("div",Un,[Le(t.$slots,"default",{},void 0,!0)])])):Z("",!0)]),_:3}))}}),$n=He(Mn,[["__scopeId","data-v-8ef1569c"]]),Dn={class:"mt-4 mx-4"},Jn={class:"text-xl text-center mb-4"},Ln={class:"flex"},Kn={class:"pl-4 pt-2 pr-4 max-h-[300px] overflow-y-auto"},Wn=F({__name:"SessionDialog",setup(e){const{t:n}=we(),t=H(()=>oe(s.session.curr)),o=H(()=>oe(s.session.total));return(r,d)=>{const f=Oe,c=Bn,w=$n;return S(),V(w,{visible:p(s).session.state!==p(se).idle},{default:ge(()=>[u("div",Dn,[u("h1",Jn,k(p(s).session.state===p(se).sending?p(n)("index.progress.titleSending"):p(n)("index.progress.titleReceiving")),1),u("div",Ln,[d[0]||(d[0]=u("span",{class:"flex-1 font-bold"},"Total:",-1)),u("span",null,k(p(t))+" / "+k(p(o)),1)]),q(f,{progress:p(s).session.curr/p(s).session.total},null,8,["progress"]),d[1]||(d[1]=u("p",{class:"mt-4 font-bold"},"Files:",-1))]),u("div",Kn,[(S(!0),v(ye,null,me(p(s).session.fileState,x=>(S(),V(c,{state:x,class:"mb-4"},null,8,["state"]))),256))])]),_:1},8,["visible"])}}}),jn={class:"dark:text-white flex flex-col h-screen"},zn={key:0,class:"flex justify-center items-center mt-8 pb-8"},Gn={class:"flex"},Hn={class:"pr-2"},Vn={key:1,class:"flex-1 flex flex-col items-center justify-center text-center px-2"},Qn={key:0,class:"text-3xl"},Yn={key:2,class:"flex-1 flex flex-col items-center justify-center text-center px-2"},qn={class:"text-3xl"},Xn={class:"mt-2"},Zn={key:3,class:"flex justify-center px-4"},et={class:"w-96"},ot=F({__name:"index",setup(e){const{t:n}=we(),{open:t,onChange:o}=We();o(async a=>{a&&a.length!==0&&s.signaling&&await vn({files:a,targetId:f.value,onPin:async()=>prompt(n("index.enterPin"))})});const r=X(!1),d=X(!0),f=X(""),c=a=>{f.value=a,t()},w=async()=>{if(!s.client)return;const a=s.client;if(!a)return;const i=prompt(n("index.enterAlias"),a.alias);!i||!s.signaling||(s.signaling.send({type:"UPDATE",info:{alias:i,version:a.version,deviceModel:a.deviceModel,deviceType:a.deviceType,token:a.token}}),bn(i))},x=async()=>{const a=prompt(n("index.enterPin"));typeof a=="string"&&(s.pin=a||null)};return je(async()=>{if(d.value=an(),setTimeout(()=>{r.value=!0},1e3),!d.value){console.error("Web Crypto API is not supported in this browser.");return}await cn(),s.key=await ln(),console.log(await dn(s.key.publicKey));const a=navigator.userAgent,i=await xe(s.key),l={alias:Cn(),version:gn,deviceModel:Pn(a),deviceType:_e.web,token:i};await Sn({info:l,onPin:async()=>prompt(n("index.enterPin"))})}),(a,i)=>{const l=en;return S(),v("div",jn,[i[3]||(i[3]=ze('<div class="flex mt-2"><img src="'+nn+'" alt="Logo" class="h-16 ml-2" style="animation:spin 10s linear infinite;"><div class="flex flex-col justify-center ml-2"><h1 class="text-xl font-bold">LocalSend</h1><h2 class="leading-none mt-0.5">Web</h2></div></div>',1)),p(s).client?(S(),v("div",zn,[u("div",Gn,[u("div",null,[Ge(k(p(n)("index.you")),1),i[0]||(i[0]=u("br",null,null,-1)),u("span",{class:"font-bold cursor-pointer",onClick:w},k(p(s).client.alias),1)]),i[2]||(i[2]=u("div",{class:"inline-block h-12 w-[2px] bg-gray-300 dark:bg-gray-700 mx-4"},null,-1)),u("div",Hn,[u("span",null,k(p(n)("index.pin.label")),1),i[1]||(i[1]=u("br",null,null,-1)),u("span",{class:"font-bold cursor-pointer",onClick:x},k(p(s).pin??p(n)("index.pin.none")),1)])])])):Z("",!0),p(s).signaling?p(s).peers.length===0?(S(),v("div",Yn,[u("h3",qn,k(p(n)("index.empty.title")),1),u("h3",Xn,k(p(n)("index.empty.deviceHint")),1),u("h3",null,k(p(n)("index.empty.lanHint")),1)])):(S(),v("div",Zn,[u("div",et,[(S(!0),v(ye,null,me(p(s).peers,h=>(S(),V(l,{key:h.id,peer:h,class:"mb-4",onClick:N=>c(h.id)},null,8,["peer","onClick"]))),128))])])):(S(),v("div",Vn,[p(r)?(S(),v("h3",Qn,k(p(d)?p(n)("index.connecting"):p(n)("index.webCryptoNotSupported")),1)):Z("",!0)])),q(Wn)])}}});export{ot as default};
